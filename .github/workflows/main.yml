name: Solana Token Monitor Bot

on:
  schedule:
    - cron: '*/5 * * * *' # Run every 5 minutes
  workflow_dispatch: # Allows manual triggering from GitHub UI

jobs:
  run_bot:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10' # Or your preferred Python version, e.g., '3.11', '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Create data directory
      # This step ensures the 'data' directory exists before main.py tries to read/write processed_tokens.json
      run: mkdir -p data

    - name: Run the bot
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHANNEL_ID: ${{ secrets.TELEGRAM_CHANNEL_ID }}
        SOLANA_RPC_URL: ${{ secrets.SOLANA_RPC_URL }}
        COMMERCIAL_METADATA_API_URL: ${{ secrets.COMMERCIAL_METADATA_API_URL }}
        COMMERCIAL_API_KEY: ${{ secrets.COMMERCIAL_API_KEY }}
        POLLING_INTERVAL_SECONDS: 60 # Set to a lower value for GitHub Actions to allow a single run
        CONCURRENT_METADATA_FETCHES: 5 # Limit concurrent calls to external APIs
        HEALTH_CHECK_PORT: 8080 # Port for health check server
        ENABLE_HEALTH_CHECK: false # Set to 'true' if you want to run health server in Actions (often not needed for cron jobs)
      run: |
        python main.py
